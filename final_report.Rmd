---
title: 'Stats 140XP: Final Project'
author: 
  - Ethan Allavarpu $\cdot$ Raymond Bai $\cdot$ Jaclyn Chiu $\cdot$ Ariel Chow $\cdot$ Carlie Lin $\cdot$ Dara Tan
  - \textbf{Explore the GLOBE}
date: "1 December 2021"
header-includes:
  - \usepackage{booktabs}
  - \usepackage{longtable}
  - \usepackage{array}
  - \usepackage{multirow}
  - \usepackage{wrapfig}
  - \usepackage{float}
  - \usepackage{colortbl}
  - \usepackage{pdflscape}
  - \usepackage{tabu}
  - \usepackage{threeparttable}
  - \usepackage{threeparttablex}
  - \usepackage[normalem]{ulem}
  - \usepackage{makecell}
  - \usepackage{xcolor}
output:
  pdf_document:
    toc: true
    toc_depth: 1
    number_sections: false
    keep_tex: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, comment = NA, fig.align = "center",
                      warning = FALSE, message = FALSE, results = FALSE,
                      out.width = "85%")
options(digits = 4)
library(knitr)
library(MASS)
library(leaps)
library(dplyr)
library(purrr)
library(kableExtra)
```


\vfill

\newpage

# Abstract

We wanted to answer two main questions: which leadership qualities do countries tend to view similarly and if countries align their perceptions societal practices and values. For determining leadership qualities and similar countries, we used principal component analysis (PCA) then $k$-means clustering to create four "clusters" of countries with similar leadership beliefs. We used the ____ method to ____. We found that ____. We also looked at _____. In the future, we recommend looking into _____. Some limitations to our project are ______. 



# Problem Statements


1. Which characteristics or traits do countries tend to group together when determining "good" leadership values?
    - Which countries have similar perceptions of these leadership values?

2. Do societal practices and societal values align? 
    - If they do not, which practices and values deviate most significantly?
    
    
# Description of Dataset

The data set we have chosen to analyze is the **Dana Landis Leadership** dataset, which comes from the GLOBE Research Survey. The data provided in the folder had survey results for (1) leadership and (2) societal and culture data and a PDF describing the nature of the survey, but nothing more. To glean more information, we found the two questionnaires (alpha and beta) described in the informational PDF to get the original questions asked in the surveys. While we do not have a "codebook" in a traditional sense, the original questions asked may help guide us in understanding what each variable means and how the survey represents respondents answers numerically. The survey is on a 1 to 7 scale, with 1 being a negative response, 4 a "neutral" score, and 7 positive.

Here is a look at 6 full and complete observations from the leadership survey:

```{r, eval = FALSE}

leadership <- read.csv("leadership.csv")

sociocultural <- read.csv("social-cultural.csv")


```

Here is a look at 6 full and complete observations from the social and cultural survey:

```{r}



```

# Description of Variables 

















# Visualization and Exploratory Data Analysis


# Analysis
## Leadership Values

```{r leadership_setup}
library(tidyverse)
library(rworldmap)
library(reshape2)
source("iso_codes.R")

col_palette <- rgb(c(0.50, 0.50, 0.00, 0.45, 0.00, 0.25, 0.75, 0.15, 0.32, 0.80),
                   c(0.50, 0.00, 0.50, 0.60, 0.00, 0.45, 0.45, 0.75, 0.25, 0.23),
                   c(0.00, 0.50, 0.50, 0.60, 0.15, 0.15, 0.00, 0.45, 0.70, 0.20),
                   alpha = 0.75)

leadership <- read.csv("GLOBE-Phase-2-Aggregated-Leadership-Data.csv")
leadership$Country.Cluster <- trimws(leadership$Country.Cluster)
countries <- data.frame("country" = leadership$Country.Name)
iso_codes <- as.data.frame(iso_codes)
names(iso_codes) <- c("code", "country")
country_codes <- countries %>% left_join(iso_codes)
country_codes[is.na(country_codes$code), "code"] <- c("GBR", "CZE", "VEN",
                                                      "IRN", "RUS", "KOR",
                                                      "ZAF", "BOL", "CHE",
                                                      "ZAF", "CAN", "DEU",
                                                      "DEU", "USA")
leadership <- leadership %>% mutate("Code" = country_codes$code)
rename_columns <- function(x) {
  new_name <- gsub(pattern = "[\\.]+", replacement = " ", x)
  new_name <- gsub(pattern = "Originally Labeled _", replacement = "(", new_name)
  gsub(pattern = "_", replacement = ")", new_name)
}
colnames(leadership) <- vapply(colnames(leadership), rename_columns, character(1))
leadership <- leadership %>% dplyr::select(-Country)
leadership <- leadership[, is.na(str_match(names(leadership),
                                           "Global Leadership Dimension"))]
```

For the leadership values problem statement, the first objective is to collapse the data into the first four principal components through principal component analysis (PCA). PCA finds the directions which capture the most variability in the data, so the first four account for the maximum variation. PCA allows us to visualize trends in the leadership values: countries tend to have similar sentiments about variables that "point" in the same direction (had principal component values that aligned).

Before performing PCA, though, we remove the second-order factor analysis variables due to the heavy correlation with the original predictor variables and a more difficult interpretation of these variables. Since our goal is to understand the relationship between certain leadership characteristics, keeping these complicated variables might reduce our understanding of some characteristics.

After performing PCA, we visualize the directions of the first two principal components. We also perform $k$-means clustering on the first four principal components to determine the "groups" of leadership characteristics that have similar perceptions:
```{r, out.width="70%"}
# PCA
num_data <- leadership[, vapply(leadership, is.numeric, logical(1))]
rownames(num_data) <- leadership$`Country Name`
pca <- prcomp(num_data)

# Cluster the leadership characteristics
pca4 <- pca$rotation[, 1:4]
set.seed(0)
w_ss <- numeric(20)
k_clust <- list()
length(k_clust) <- 20
for (k in seq_along(w_ss)) {
  k_clusters <- kmeans(pca4, centers = k, nstart = 20)
  k_clust[[k]] <- k_clusters
  w_ss[k] <- k_clusters$tot.withinss
}
## k = 5 seems best, but k = 3 provides more relevant groups
cols <- rgb(c(0.25, 0.50, 0.00), c(0.50, 0.00, 0.50), c(0.00, 0.50, 0.50),
            alpha = 0.75)[k_clust[[3]]$cluster]
plot(pca4[, 1:2], xlim = c(-0.5, 0.5), ylim = c(-0.4, 0.4), pch = 19,
     col = cols, type = "n", las = 1,
     main = "First Two Principal Components with Each Variable's Loading")
arrows(0, 0, x1 = pca4[, 1], y1 = pca4[, 2], length = 0.1, col = cols)
abline(h = 0)
abline(v = 0)
legend("bottomleft",
       col = rgb(c(0.25, 0.50, 0.00), c(0.50, 0.00, 0.50), c(0.00, 0.50, 0.50),
                 alpha = 0.75),
       lty = 1,
       legend = 1:3,
       title = "Variable Cluster",
       inset = 0.05,
       cex = 0.75)
```



```{r}
melt(pca4) %>%
  ggplot(aes(x = Var1, y = Var2, fill = value)) +
  geom_tile() +
  scale_fill_gradient2(low = rgb(0.5, 0, 0, alpha = 1),
                       high = rgb(0, 0.5, 0, alpha = 1),
                       mid = "white",
                       midpoint = 0, space = "Lab",
                       name = "PCA Coefficient") +
  labs(title = "PCA Coefficients for Each Variable",
       x = "Variable", y = "Principal Component Number",
       caption = "Note: Variables colored by cluster") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, size = 8, hjust = 1),
        axis.text.y = element_text(color = cols, size = 8)) +
  coord_flip()
```


After considering the leadership characteristics, we cluster countries based on similar perceptions. We do this by using the variables of the countries transformed into the first four principal components, then running PCA on those components. The clustering results segregate the countries into the following segments:

```{r}
# Use first four principal components for clustering
pca_x <- pca$x[, 1:4]
set.seed(85)
w_ss <- numeric(30)
k_clust <- list()
length(k_clust) <- 30
for (k in seq_along(w_ss)) {
  k_clusters <- kmeans(pca_x, centers = k, nstart = 20)
  k_clust[[k]] <- k_clusters
  w_ss[k] <- k_clusters$tot.withinss
}

## 4 clusters appears to be the best
best_4 <- k_clust[[4]]
leadership <- mutate(leadership, "Similar Values" = factor(best_4$cluster))

# K-means Clusters and Leadership Values ----
mapped_data <- joinCountryData2Map(leadership, nameJoinColumn = "Code")
mapCountryData(mapped_data, nameColumnToPlot = "Similar Values",
               numCats = 4, catMethod = "categorical",
               colourPalette = col_palette[seq_len(4) + 3],
               borderCol = "black",
               missingCountryCol = rgb(0, 0, 0, alpha = 0.5),
               mapTitle = "Country Clusters with Similar Leadership Values",
               addLegend = FALSE)
```
```{r, results = TRUE}
country_clusters <- matrix(nrow = max(table(best_4$cluster)), ncol = 4)
for (i in unique(best_4$cluster)) {
  country_clusters[seq_len(sum(best_4$cluster == i)), i] <-
    names(best_4$cluster)[best_4$cluster == i]
}
cluster_cols <- col_palette[seq_len(4) + 3]
country_clusters[is.na(country_clusters)] <- ""
kbl(data.frame(country_clusters),
    col.names = paste("Cluster", 1:4),
    booktabs = TRUE,
    position = "h",
    caption = "Regions with Similar Leadership Perceptions") %>%
  kable_styling(latex_options = "striped") %>%
  column_spec(1, color = cluster_cols[1]) %>%
  column_spec(2, color = cluster_cols[2]) %>%
  column_spec(3, color = cluster_cols[3]) %>%
  column_spec(4, color = cluster_cols[4])
```

```{r}
characteristic_values <- sapply(num_data, FUN = function(x) {
  tapply(X = x, INDEX = leadership$`Similar Values`, FUN = median)
  })
characteristic_values <- characteristic_values[, apply(characteristic_values,
                                                       2, mean) %>% order()]
melt(characteristic_values) %>%
  ggplot(aes(x = Var1, y = Var2, fill = value)) +
  geom_tile() +
  scale_fill_gradient2(low = rgb(0.5, 0, 0, alpha = 1),
                       high = rgb(0, 0.5, 0, alpha = 1),
                       midpoint = 4, space = "Lab",
                       name = "Median Survey Score") +
  labs(title = "Median Leadership Category Scores by Cluster",
       x = "Cluster", y = "Leadership Category") +
  theme_minimal() +
  theme(axis.text.x = element_text(color = col_palette[seq_len(4) + 3]),
        axis.text.y = element_text(color = cols, size = 8))
```


## Societal Practices and Values

For this section, since we consider nine societal practice vs. value concepts, so maintaining a significance level of $\alpha = 0.05$ increases the experimentwise error rate: $P(\text{Any False Positive}) = 1 - P(\text{No False Positives}) = 1 - 0.95^{9} \approx `r round(1 - 0.95^9, 4)`$. To remedy this issue, we employ a *Bonferroni correction* to change the significance threshold from $\alpha = 0.05$ to $\alpha = \frac{0.05}{9} \approx `r round(0.05 / 9, 4)`$.






# Conclusions



# Suggestions for Further Research 

# Limitations

While promising, there are a few issues with the data we have to consider. First, the number of observations: 62 observations is a rather small dataset, which suggest that any analysis will likely be limited. Also, the data silences are important and should not be overlooked. Why were certain countries not surveyed? 
